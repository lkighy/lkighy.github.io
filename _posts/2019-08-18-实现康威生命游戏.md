---
title: å®ç°åº·å¨ç”Ÿå‘½æ¸¸æˆ
description: åœ¨æˆ‘ä»¬æ·±å…¥ä¹‹å‰,æˆ‘ä»¬æœ‰ä¸€äº›è®¾è®¡éœ€è¦è€ƒè™‘.
categories:
  - rust/WebAssembly
tags: [rust, WebAssembly, ç¿»è¯‘]
---

## è®¾è®¡

åœ¨æˆ‘ä»¬æ·±å…¥ä¹‹å‰,æˆ‘ä»¬æœ‰ä¸€äº›è®¾è®¡éœ€è¦è€ƒè™‘.

### æ— çº¿çš„ universe

ç”Ÿå‘½æ¸¸æˆæ˜¯åœ¨æ— çº¿çš„ universe ä¸­è¿›è¡Œçš„,ä½†æˆ‘ä»¬æ²¡æœ‰æ— é™çš„å†…å­˜å’Œè®¡ç®—èƒ½åŠ›.è§£å†³è¿™ä¸ªç›¸å½“çƒ¦äººçš„é™åˆ¶é€šå¸¸ç”±ä¸€ä¸‹ä¸‰ç§é€‰æ‹©:

1. è·Ÿè¸ª universe çš„å“ªä¸ªå­é›†å‘ç”Ÿäº†æœ‰è¶£çš„äº‹æƒ…,å¹¶æ ¹æ®éœ€è¦æ‰©å±•æ­¤åŒºåŸŸ.åœ¨æœ€åçš„æƒ…å†µä¸‹,è¿™ç§æ‰©å±•æ˜¯æ— é™åˆ¶çš„,å®ç°å°†å˜å¾—è¶Šæ¥è¶Šæ…¢,,æœ€ç»ˆè€—å°½å†…å­˜.
2. åˆ›å»ºå›ºå®šå¤§å°çš„ universe ,å…¶ä¸­è¾¹ç¼˜ä¸Šçš„å•å…ƒæ ¼æ¯”ä¸­é—´çš„å•å…ƒæ ¼å…·æœ‰æ›´å°‘çš„é‚»å±….è¿™ç§æ–¹æ³•ç¼ºç‚¹æ˜¯è¾¾åˆ° universe å°½å¤´çš„æ— é™çš„,å¦‚åŒæ»‘ç¿”æœºè¿™æ ·çš„åˆ°è¾¾äº† universe å°½å¤´,éƒ½ä¼šè¢«æ¶ˆç­.
3. åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°å›ºå®šå‘¨æœŸçš„ universe ,å…¶ä¸­è¾¹ç¼˜ä¸Šçš„å•å…ƒæ ¼è¿æ¥ç€ universe å¦ä¸€ä¾§çš„å•å…ƒæ ¼,å› ä¸ºè¿æ¥ä¸´è¿‘çš„ universe ,æ»‘ç¿”æœºå¯ä»¥æ°¸è¿œè¿è¡Œä¸‹å».

æˆ‘ä»¬å°†å®ç°ç¬¬ä¸‰ç§é€‰æ‹©.

### è¿æ¥ Rust å’Œ JavaScript

> âš¡å³ä¾¿ç¦»å¼€äº†æœ¬æ•™ç¨‹,è¿™ä¹Ÿæ˜¯æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€!

JavaScript ä¸­çš„åƒåœ¾å›æ”¶å™¨(å…¶ä¸­åˆ†é…äº† `object`, `array` å’Œ DOM èŠ‚ç‚¹) ä¸ WebAssembly çš„çº¿æ€§å†…å­˜ç©ºé—´ä¸åŒ,åè€…å­˜åœ¨äº Rust å€¼æ‰€åœ¨çš„ç©ºé—´.WebAssembly ç›®å‰æ— æ³•ç›´æ¥è®¿é—®åƒåœ¾å›æ”¶å™¨(æˆªè‡³ 2018å¹´ 4æœˆ,é¢„è®¡ä¼šéšç€ ["webIDL bindings" ææ¡ˆ](https://github.com/WebAssembly/webidl-bindings/blob/master/proposals/webidl-bindings/Explainer.md)è€Œæ”¹å˜).å¦ä¸€æ–¹é¢,JavaScript å¯ä»¥è¯»å–å’Œå†™å…¥ WebAssembly çº¿æ€§å†…å­˜ç©ºé—´,ä½†åªèƒ½ä½œä¸º [`ArrayBuffer`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer) çš„æ ‡é‡å€¼(`u8`, `i32`, f64` ç­‰ç­‰...).WebAssembly å‡½æ•°ä¹Ÿæ¥å—å¹¶è¿”å›æ ‡é‡å€¼.è¿™äº›æ˜¯æ„æˆæ‰€æœ‰ WebAssembly å’Œ JavaScript é€šä¿¡çš„æ„å»ºå—.

`wasm_bindgen` å®šä¹‰äº†å¦‚ä½•è·¨è¶Šæ­¤è¾¹ç•Œé€‚ç”¨ç¬¦åˆæ„å»ºçš„å…±åŒåè®®.å®ƒæ¶‰åŠè£…ç®± Rust ç»“æ„,å°†æŒ‡é’ˆåŒ…è£…åœ¨ JavaScript ç±»ä¸­æˆ–ä» Rust ç´¢å¼•åˆ° JavaScript å¯¹è±¡è¡¨ä¸­ä»¥ä¾¿ä½¿ç”¨.`wasm_bindgen` éå¸¸æ–¹ä¾¿,ä½†å®ƒä¸éœ€è¦æˆ‘ä»¬è€ƒè™‘æ•°æ®è¡¨ç¤º,ä»¥åŠè·¨è¶Šæ­¤è¾¹ç•Œä¼ é€’çš„å€¼å’Œç»“æ„.ç›¸å,æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºå®ç°æ‰€æœ‰ç•Œé¢è®¾è®¡çš„å·¥å…·.

åœ¨è®¾è®¡ webAssembly å’Œ JavaScript ä¹‹é—´çš„æ¥å£æ—¶,æˆ‘ä»¬å¸Œæœ›é’ˆå¯¹ä¸€ä¸‹å±æ€§è¿›è¡Œä¼˜åŒ–:

1. **å¤åˆ¶è¿›å…¥ WebAssembly çº¿æ€§å†…å­˜çš„å°†æ˜¯æœ€å°åŒ–çš„.**ä¸å¿…è¦çš„å‰¯æœ¬ä¼šå¸¦æ¥ä¸å¿…è¦çš„å¼€é”€.
2. **æœ€å°åºåˆ—åŒ–å’Œååºåˆ—åŒ–.**ä¸å‰¯æœ¬ç±»ä¼¼,åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¹Ÿä¼šäº§ç”Ÿå¼€é”€,å¹¶ä¸”é€šå¸¸ä¼šé€ æˆå¤åˆ¶.å¦‚æœæˆ‘ä»¬å¯ä»¥å°†ä¸é€æ˜å¥æŸ„ä¼ é€’ç»™æ•°æ®ç»“æ„ - è€Œä¸æ˜¯åœ¨ä¸€ä¾§å°†å…¶åºåˆ—åŒ–,å†å¤åˆ¶åˆ° WebAssembly çº¿æ€§å†…å­˜ä¸­çš„æŸä¸ªå·²çŸ¥ä½ç½®,å¹¶å†å¦ä¸€ä¾§è¿›è¡Œååºåˆ—åŒ– - æˆ‘ä»¬é€šå¸¸å¯ä»¥å‡å°‘å¤§é‡å¼€é”€.`wasm_bindgen` å¸®åŠ©æˆ‘ä»¬å®šä¹‰å¯å¤„ç† JavaScript å¯¹è±¡æˆ–å°† Rust ç»“æ„è£…å…¥ä¸é€æ˜å¥æŸ„.

é€šå¸¸çš„ç»éªŒæ—¶,è‰¯å¥½çš„ JavaScript â†” WebAssembly æ¥å£è®¾è®¡é€šå¸¸æ—¶é—´å¤§å‹çš„,é•¿æœŸå­˜åœ¨çš„æ•°æ®ç»“æ„å®ç°ä¸ºé©»ç•™åœ¨ WebAssembly çš„ Rust ç±»å‹,å¹¶å°†å…¶ä½œä¸ºä¸é€æ˜å¥æŸ„æš´éœ²ç»™ JavaScript .JavaScript è°ƒç”¨å¯¼å‡ºçš„ WebAssembly å‡½æ•°,è¿™äº›å‡½æ•°æ¥å—è¿™äº›ä¸é€æ˜å¥æŸ„,è½¬æ¢æ•°æ®,æ‰§è¡Œç¹é‡çš„è®¡ç®—,æŸ¥è¯¢æ•°æ®,æœ€ç»ˆè¿”å›ä¸€ä¸ªå°çš„å¯å¤åˆ¶çš„ç»“æœ.é€šè¿‡è¿”å›è®¡ç®—çš„å°å°çš„ç»“æœ,æˆ‘ä»¬é¿å…åœ¨ JavaScript åƒåœ¾å›æ”¶å™¨ å’Œ WebAssembly çº¿æ€§å†…å­˜ä¹‹é—´æ¥å›å¤åˆ¶/åºåˆ—åŒ–æ‰€æœ‰å†…å®¹.

### åœ¨æˆ‘ä»¬çš„ç”Ÿå‘½æ¸¸æˆä¸­è¿æ¥ Rust å’Œ JavaScript

é¦–å…ˆæˆ‘ä»¬åˆ—ä¸¾ä¸€äº›è¦é¿å…çš„å±é™©,æˆ‘ä»¬ä¸å¸Œæœ›å†æ¯ä¸ª tick ä¸Šå°†æ•´ä¸ª universe å¤åˆ¶åˆ° WebAssembly çº¿æ€§å†…å­˜ä¸­.æˆ‘ä»¬ä¸å¸Œæœ›ä¸º universe ä¸­æ¯ä¸ªå•å…ƒåˆ†é…å¯¹è±¡,ä¹Ÿä¸æƒ³å¼ºåˆ¶è¿›è¡Œè·¨è¾¹ç•Œè°ƒç”¨æ¥è¯»å†™æ¯ä¸ªå•å…ƒ.

è¿™ä¼šç»™æˆ‘ä»¬ç•™ä¸‹ä»€ä¹ˆ?æˆ‘ä»¬å¯ä»¥å°† universe è¡¨ç¤ºä¸ºä¸€ä¸ªå¹³é¢æ•°ç»„,å®ƒå­˜åœ¨äº WebAssembly çº¿æ€§å†…å­˜ä¸­,æ¯ä¸ªå•å…ƒéƒ½æœ‰ä¸€ä¸ªå­—èŠ‚.  0 æ˜¯æ­»ç»†èƒ,1 æ˜¯æ´»ç»†èƒ.

è¿™æ˜¯ 4 Ã— 4  universe å†å†…å­˜ä¸­çš„æ ·å­:

![universe](../images/universe.png)

è¦åœ¨  universe ä¸­çš„ç»™å®šè¡Œå’Œåˆ—ä¸­æŸ¥æ‰¾å•å…ƒæ ¼çš„æ•°ç»„ç´¢å¼•,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹å…¬å¼:

```text
index(row, column, universe) = row * width(universe) + column
```

æˆ‘ä»¬æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°† universe çš„å•å…ƒæ ¼æš´éœ²ç»™ JavaScript.é¦–å…ˆ,æˆ‘ä»¬å°† `Universe` å®ç° `std::fmt::Display`,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ç”Ÿæˆå‘ˆç°ä¸ºæ–‡æœ¬å­—ç¬¦çš„å•å…ƒæ ¼ Rust String.ç„¶åå°†æ­¤ Rust String ä» WebAssembly å…ˆè¡Œå†…å­˜å¤åˆ¶åˆ° JavaScript çš„åƒåœ¾å›æ”¶å™¨ä¸­çš„ JavaScript String ä¸­,ç„¶åé€šè¿‡ è®¾ç½® HTML textContent æ˜¾ç¤º.å†æœ¬ç« çš„åé¢æˆ‘ä»¬å°†æ”¹è¿›è¿™ä¸ªå®ç°,ä»¥é¿å…å†é˜Ÿä¹‹é—´å¤åˆ¶ universe çš„å•å…ƒæ ¼æ¸²æŸ“åˆ° `<canvas>`(ç”»å¸ƒ).

*å¦ä¸€ä¸ªå¯è¡Œçš„è®¾è®¡ä»£æ›¿æ–¹æ¡ˆæ˜¯ Rust è¿”å›æ¯ä¸€ä¸ªæ›´æ”¹çŠ¶æ€åçš„ç»†èƒçš„å•å…ƒæ ¼åˆ˜è¡¨,è€Œä¸æ˜¯æ•´ä¸ª universe æš´éœ²ç»™ JavScript.è¿™æ ·,JavaScript åœ¨æ¸²æŸ“æ—¶ä¸éœ€è¦éå†æ•´ä¸ª universe, åªéœ€è¦ç›¸å…³çš„å­é›†.æŠ˜ä¸­ä¹‹å¤„åœ¨äº,è¿™ç§åŸºäº delta-based è®¾è®¡æ›´éš¾å®ç°.*

## Rustå®ç°

åœ¨ä¸Šä¸€ç« ä¸­,æˆ‘ä»¬å…‹éš†äº†ä¸€ä¸ªåˆå§‹é¡¹ç›®æ¨¡æ¿.æˆ‘ä»¬ç°åœ¨å°†ä¿®æ”¹è¯¥é¡¹ç›®æ¨¡æ¿.

è®©æˆ‘ä»¬é¦–å…ˆä» `wasm-game-of-life/ssrc/lib.rs` ä¸­åˆ é™¤ `alert` æ¨¡å—å’Œ `greet` å‡½æ•°,ç„¶åå®šä¹‰å•å…ƒæ ¼çš„ç±»å‹æ›¿æ¢å®ƒä»¬:

```rust
#[wasm_bindgen]
#[repr(u8)]
#[derive(clone, Copy, Debug, PartialEq, Eq)]
pub enum Cell {
    Dead = 0,
    Alive = 1,
}
```

é‡è¦çš„æ˜¯æˆ‘ä»¬æœ‰ `#[repr(u8)]`,å› æ­¤æ¯ä¸ªå•å…ƒæ ¼éƒ½è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­—èŠ‚.åŒæ ·é‡è¦çš„æ˜¯, `Dead` å˜é‡ä¸º `0`,`Alive` å˜é‡ä¸º `1`,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ æ¥è½»æ¾è®¡ç®—å•å…ƒæ ¼æ´»ç€çš„é‚»å±….

æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®šä¹‰ universe,universe å…·æœ‰å®½åº¦å’Œé«˜åº¦,ä»¥åŠ `width * height` çš„é•¿åº¦çš„å‘é‡.

```rust
#[wasm_bindgen]
pub struct Universe {
    width: u32,
    height: u32,
    cells: Vec<Cell>,
}
```

è¦è®¿é—®ç»™å®šè¡Œå’Œåˆ—çš„å•å…ƒæ ¼,æˆ‘ä»¬å°†è¡Œå’Œåˆ—è½¬æ¢ä¸ºå•å…ƒæ ¼å‘é‡çš„ç´¢å¼•,å¦‚å‰æ‰€è¿°:

```rust
impl Universe {
    fn get_index(&self, row: u32, column: u32) -> usize {
        (row * self.width + column) as usize
    }

    // ...
}
```
ä¸ºäº†è®¡ç®—å•å…ƒæ ¼çš„ä¸‹ä¸€çŠ¶æ€,æˆ‘ä»¬éœ€è¦è®¡ç®—å™¨é‚»å±…æ•°é‡æ˜¯å¤šå°‘.è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª `live_neighbor_count` æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹!

```rust
impl Universe {
    // ...

    fn live_neighbor_count(&self, row: u32, column: u32) -> u8 {
        let mut count = 0;
        for delta_row in [self.height - 1, 0, 1].iter().cloned() {
            for delta_col in [self.width - 1, 0, 1].iter().cloned() {
                if delta_row == 0 && delta_col == 0 {
                    continue;
                }

                let neighbor_row = (row + delta_row) % self.height;
                let neighbor_col = (column + delta_col) % self.width;
                let idx = self.get_index(neighbor_row, neighbor_col);
                count += self.cells[idx] as u8;
            }
        }
        count
    }
}
```

`live_neighobor_count` æ–¹æ³•ä½¿ç”¨ deltas å’Œå–ä½™çš„æ–¹æ³•å¯¹ universe è¾¹ç¼˜è¿›è¡Œç‰¹æ®ŠåŒ…è£…æ¥é¿å…ä½¿ç”¨ `if`. å½“ delta `-1` æ—¶,æˆ‘ä»¬æ·»åŠ  `self.height - 1` å¹¶ä½¿ç”¨å–ä½™æ¥å®Œæˆè¿™ä»¶äº‹,è€Œä¸æ˜¯ä½¿ç”¨ `-1` . `row` å’Œ `column` å¯ä»¥ä¸ºé›¶,å¦‚æœæˆ‘ä»¬è¯•å›¾è®©ä¸º `0` çš„å®ƒä»¬å‡å» `1` ,åˆ™ä¼šå‡ºç°æ— ç¬¦å·æ•´æ•°ä¸‹æº¢.

ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä»å½“å‰ä¸€ä»£è®¡ç®—ä¸‹ä¸€ä»£æ‰€éœ€è¦çš„ä¸€åˆ‡!ç°åœ¨å°†æ¸¸æˆçš„æ¯ä¸€ä¸ªè§„åˆ™è½¬æ¢ä¸º `match` è¡¨è¾¾å¼ä¸Šçš„æ¡ä»¶.å¦å¤–,æˆ‘ä»¬å¸Œæœ› JavaScript 

ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä»å½“å‰è®¡ç®—ä¸‹ä¸€ä»£æ‰€éœ€çš„ä¸€åˆ‡!æ¸¸æˆçš„æ¯ä¸€ä¸ªè§„åˆ™éƒ½éµå¾ªä¸€ä¸ªç®€å•çš„è½¬æ¢ä¸º `match` è¡¨è¾¾å¼çš„æ¡ä»¶.å¦å¤–,æˆ‘ä»¬å¸Œæœ› javaScript é€šè¿‡ tick æ§åˆ¶å‘ç”Ÿçš„æ—¶é—´,å› æ­¤æˆ‘ä»¬ä¼šå°†æ­¤æ–¹æ³•æ”¾åœ¨ `#[wasm_bindgen]` å—ä¸­,è¿™æ ·å®ƒå°±ä¼šæš´éœ²ç»™ JavaScript.

```rust
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    pub fn tick(&mut self) {
        let mut next = self.cells.clone();

        for row in 0..self.height {
            for col in 0..self.width {
                let idx = self.get_index(row, col);
                let cell = self.cells[idx];
                let live_neighbors = self.live_neighbor_count(row, col);

                let next_cell = match (cell, live_neighbors) {
                    // Rule 1: Any live cell with fewer than two live neighbours
                    // dies, as if caused by underpopulation.
                    (Cell::Alive, x) if x < 2 => Cell::Dead,
                    // Rule 2: Any live cell with two or three live neighbours
                    // lives on to the next generation.
                    (Cell::Alive, 2) | (Cell::Alive, 3) => Cell::Alive,
                    // Rule 3: Any live cell with more than three live
                    // neighbours dies, as if by overpopulation.
                    (Cell::Alive, x) if x > 3 => Cell::Dead,
                    // Rule 4: Any dead cell with exactly three live neighbours
                    // becomes a live cell, as if by reproduction.
                    (Cell::Dead, 3) => Cell::Alive,
                    // All other cells remain in the same state.
                    (otherwise, _) => otherwise,
                };

                next[idx] = next_cell;
            }
        }

        self.cells = next;
    }

    // ...
}

```

åˆ°ç›®å‰ä¸ºæ­¢, Universe ç»†èƒçš„çŠ¶æ€è¢«è¡¨ç°ä¸º Vec.ä¸ºäº†è®©å…¶æ›´å®¹è¯»,è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªåŸºæœ¬çš„æ–‡æœ¬æ¸²æŸ“å™¨(text renderer).æˆ‘ä»¬çš„æƒ³æ³•æ—¶å°† Universe é€è¡Œå†™ä¸ºæ–‡æœ¬,å¯¹äºæ¯ä¸ªæ´»ç»†èƒ,æˆ‘ä»¬å°†æ‰“å° Unicoe å­—ç¬¦ `â—¼`("é»‘è‰²ä¸­ç­‰æ–¹å—").å¯¹äºæ­»ç»†èƒ,æˆ‘ä»¬å°†æ‰“å°`â—»`("ç™½è‰²ä¸­ç­‰æ–¹å—").

é€šè¿‡å®ç° Rust æ ‡å‡†åº“ä¸­ `Display` çš„ trait, æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ç§ä»¥é¢å‘ç”¨æˆ·çš„æ–¹å¼çš„æ ¼å¼åŒ–ç»“æ„çš„æ–¹æ³•.è¿™ä¹Ÿä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ä¸€ä¸ª `to_string` æ–¹æ³•.

```rust

use std::fmt;

impl fmt::Display for Universe {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        for line in self.cells.as_slice().chunks(self.width as usize) {
            for &cell in line {
                let symbol = if cell == Cell::Dead { 'â—»' } else { 'â—¼' };
                write!(f, "{}", symbol)?;
            }
            write!(f, "\n")?;
        }

        Ok(())
    }
}

```

æœ€å,æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°,ç”¨ä¸€ä¸ªæœ‰è¶£çš„æ´»ç»†èƒæ­»ç»†èƒæ¨¡å¼åˆå§‹åŒ–å®‡å®™,ä»¥åŠä¸€ä¸ª `render` æ–¹æ³•:

```rust
/// Public methods, exported to JavaScript.
#[wasm_bindgen]
impl Universe {
    // ...

    pub fn new() -> Universe {
        let width = 64;
        let height = 64;

        let cells = (0..width * height)
            .map(|i| {
                if i % 2 == 0 || i % 7 == 0 {
                    Cell::Alive
                } else {
                    Cell::Dead
                }
            })
            .collect();

        Universe {
            width,
            height,
            cells,
        }
    }

    pub fn render(&self) -> String {
        self.to_string()
    }
}
```

æœ‰äº†è¿™ä¸ª,æˆ‘ä»¬ Rust å®ç°çš„ç”Ÿå‘½æ¸¸æˆå°±å®Œæˆä¸€åŠäº†!

é€šè¿‡ `wasm-pack` åœ¨ `wasm-game-of-life` ç›®å½•ä¸­è¿è¡Œå°†å…¶é‡æ–°ç¼–è¯‘ä¸º WebAssembly.

## ä½¿ç”¨ JavaScript æ¸²æŸ“

é¦–å…ˆ,è®©æˆ‘ä»¬åœ¨ `wasm-game-of-life/www/index.html` ä¸­æ·»åŠ ä¸€ä¸ª `<pre>` å…ƒç´ æ¥æ¸²æŸ“ universe,å°±æ·»åŠ åœ¨ `<script>` æ ‡ç­¾ä¸Šæ–¹:

```html
<body>
  <pre id="game-of-life-canvas"></pre>
  <script src="./bootstrap.js"></script>
</body>
```

æ­¤å¤–,æˆ‘ä»¬å¸Œæœ› `<pre>` å±…ä¸­åœ¨ç½‘é¡µçš„ä¸­é—´.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CSS å¼¹æ€§ç›’å­æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡. åœ¨ `wasm-game-of-life/www/index.html` ä¸­ `head`æ ‡ç­¾æ·»åŠ  `<style>` æ ‡ç­¾:

```html
<style>
  body {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
</style>
```

åœ¨ `wasm-game-of-life/www/index.js` çš„é¡¶éƒ¨,è®©æˆ‘ä»¬å¯¼å…¥çš„ `greet` æ–¹æ³•æ›¿æ¢ä¸º `Universe`:

```js
import { Universe } from "wasm-game-of-life";
```

å¦å¤–,è®©æˆ‘ä»¬ä¸ºåˆšåˆšæ·»åŠ çš„ `<pre>` å…ƒç´ å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ Universe:

```js
const pre = document.getElementById("game-of-life-canvas");
const universe = Universe.new();
```

JavaScript è¿è¡Œåœ¨ä¸€ä¸ª [`requestAnimationFrame` å¾ªç¯ä¸­](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame).åœ¨æ¯æ¬¡è¿­ä»£ä¸­,ä»–å°†å½“å‰ Universe ç»˜åˆ¶åˆ° `<pre>` ,ç„¶åè°ƒç”¨ `Universe::tick`.

```js
const renderLoop = () => {
    pre.textContent = universe.render()
    universe.tick();

    requestAnimationFrame(renderLoop);
}
```

è¦å¼€å§‹æ¸²æŸ“è¿‡ç¨‹å‰,æˆ‘ä»¬è¿˜è¦ä¸ºæ¸²æŸ“å¾ªç¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£è¿›è¡Œåˆå§‹åŒ–è°ƒç”¨:

```js
requestAnimationFrame(renderLoop);
```

æœªå®Œå¾…ç»­...

- ä¸‹ä¸€ç¯‡:[**æµ‹è¯•åº·å¨ç”Ÿå‘½æ¸¸æˆ**](javascript:;)
- ä¸Šä¸€ç¯‡:[**åº·å¨ç”Ÿå‘½æ¸¸æˆè§„åˆ™**](/rust/webassembly/2019/07/13/åº·å¨ç”Ÿå‘½æ¸¸æˆè§„åˆ™/)
- å¦‚æœæ‚¨è¿˜è¯»è¿‡è¯¥ç³»åˆ—æ–‡ç« ,å»ºè®®æ‚¨ä»[**Rust ğŸ¦€ å’Œ WebAssembly ğŸ•¸**](/rust/webassembly/2019/07/07/rust-å’Œ-WebAssembly/)å¼€å§‹é˜…è¯»

---

- via: [https://rustwasm.github.io/book/game-of-life/implementing.html](https://rustwasm.github.io/book/game-of-life/implementing.html)
- è¯‘è€…: lkighy
- æ ¡å¯¹: -
